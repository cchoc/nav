import{a as te}from"./chunk-CVDEXY72.js";import{b as G}from"./chunk-6WCNOAP4.js";import"./chunk-3KEVNYMN.js";import{i as j}from"./chunk-VKE4KYM4.js";import"./chunk-F4AMA3BU.js";import{ja as _,mc as K,nc as X,pc as Y,qc as Z,uc as ee}from"./chunk-FTQGFGRM.js";import{Ac as H,Ce as v,Vb as x,Wb as P,Xb as I,Yb as O,dc as $,gb as M,gc as A,kb as z,nc as F,oc as V,pb as B,pc as W,te as J,vb as R,xa as D,ya as C,yc as Q,ze as U}from"./chunk-NXXNJEWX.js";var f=J(),b=n=>(n.textContent||"").trim(),oe=n=>(n.getAttribute("href")||"").trim(),w=n=>(n.getAttribute("icon")||"").trim();function L(n){let a=[];return Array.from(n.children).forEach(e=>{if(e.nodeName==="DT"){let r=e.firstElementChild;r?.nodeName==="A"&&a.push({name:b(r),icon:w(r),url:oe(r),tags:[],desc:"",rate:5,id:f+=1,breadcrumb:[]})}}),a}function ie(n){let a=JSON.parse(JSON.stringify(U())),e=[],p=new DOMParser().parseFromString(n,"text/html"),N=n.includes('PERSONAL_TOOLBAR_FOLDER="true"')?"body dl dl":"body dl",y=p.querySelector(N);if(!y)return{message:"\u672A\u627E\u5230dl dl\u8282\u70B9"};try{let g=function(l,c){Array.from(l.children).forEach(t=>{if(t.nodeName==="DT"){let i=t.querySelector("a");i&&c.nav.push({name:b(i),url:oe(i),desc:"",tags:[],rate:5,top:!1,icon:w(i),id:f+=1,breadcrumb:[]})}})},d=function(l,c){Array.from(l.children).forEach((t,i)=>{if(t.nodeName==="DT"){let h=t.querySelector("h3");if(h){let o=b(h);c.nav.some(T=>T.title===o)&&(o=o+i);let m={id:f+=1,title:o,nav:[],icon:""};c.nav.push(m);let S=t.querySelector("dl");S&&g(S,m)}}})},k=function(l,c){Array.from(l.children).forEach((t,i)=>{if(t.nodeName==="DT"){let h=t.querySelector("h3");if(h){let o=b(h);c.nav.some(T=>T.title===o)&&(o=o+i);let m={id:f+=1,title:o,icon:w(h),nav:[]};c.nav.push(m);let S=t.querySelector("dl");if(S){let T=L(S);T.length>0&&m.nav.push({id:f+=1,title:o,icon:"",nav:T}),d(S,m)}}}})};var ne=g,se=d,ae=k;Array.from(y.children).forEach((l,c)=>{if(l.nodeName==="DT"){let t=l.querySelector("h3");if(t){let i=b(t);e.some(m=>m.title===i)&&(i=i+c);let o={id:f+=1,title:i,icon:w(t),nav:[]};e.push(o);let E=l.querySelector("dl");if(E){let m=L(E);m.length>0&&o.nav.push({id:f+=1,title:i,icon:"",nav:[{id:f+=1,title:i,icon:"",nav:m}]}),k(E,o)}}}});let s=L(y);s.length>0&&e.push({id:f+=1,title:v("_uncategorized"),icon:"",nav:[{id:f+=1,title:v("_uncategorized"),icon:"",nav:[{id:f+=1,title:v("_uncategorized"),icon:"",nav:s}]}]})}catch(g){throw console.log(g),g}function u(g,d){for(let k=0;k<g.length;k++){let s=g[k],l=(s.title||_(s.url)).trim(),c=d.findIndex(t=>(t.title||_(t.url)).trim()===l);if(c!==-1)Array.isArray(s.nav)&&u(s.nav,d[c].nav);else{let t=_((s.url||"").trim());s.url&&(d.some(o=>_(o.url).trim()===t)||d.push(s));let i=(s.title||"").trim();s.title&&(d.some(o=>o.title?.trim()===i)||d.push(s))}}}return u(e,a),a}var re=["file"],q=class n{constructor(a,e){this.message=a;this.notification=e}file;$t=v;ngOnInit(){}onClickFile(){this.file.nativeElement.click()}onBookChange(a){let e=this,{files:r}=a.target;if(console.log(r.length),r.length<=0)return;let p=r[0],N=new FileReader;N.readAsText(p),N.onload=function(){let y=this.result;console.log(y);try{let u=ie(y);console.log(u),Array.isArray(u)?(e.message.success(v("_importSuccess")),G(u),setTimeout(()=>window.location.reload(),2e3)):e.notification.error(v("_errorBookTip"),`${u?.message??""}`)}catch(u){e.notification.error(v("_errorBookTip"),`${u.message}`)}a.target.value=""}}static \u0275fac=function(e){return new(e||n)(B(ee),B(te))};static \u0275cmp=R({type:n,selectors:[["system-bookmark"]],viewQuery:function(e,r){if(e&1&&F(re,5),e&2){let p;V(p=W())&&(r.file=p.first)}},decls:6,vars:2,consts:[["file",""],[1,"text-center","mt-10"],[1,"mb-4",3,"innerHTML"],["nz-button","","nzType","primary",3,"click"],["type","file","accept","text/html",1,"!hidden",3,"change"]],template:function(e,r){if(e&1){let p=$();P(0,"div",1),O(1,"div",2),P(2,"button",3),A("click",function(){return D(p),C(r.onClickFile())}),Q(3),I(),P(4,"input",4,0),A("change",function(y){return D(p),C(r.onBookChange(y))}),I()()}e&2&&(z(),x("innerHTML",r.$t("_importEnter"),M),z(2),H(" ",r.$t("_upload")," "))},dependencies:[j,Z,Y,K,X],encapsulation:2})};export{q as default};
